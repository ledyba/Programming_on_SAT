# BrainfuckをSATへ変換する

　足し算と引き算しかしていませんが、ここまでくれば超カンタンです。足し算・引き算と同じことを繰り返せばOKなのですから。（というか夜３時なのでいよいよ時間的余裕がなくなってきた）

## 5秒でおさらいBrainfuck

　Brainfuckはたった8文字だけで記述するプログラミング言語です。

　Brainfuckにはメモリの概念と今現在どこを指しているかのポインタの概念、さら入力と出力があり、次の8文字（命令）を使ってそのメモリとポインタを操作します。

　[Wikipediaから引用](https://ja.wikipedia.org/wiki/Brainfuck)：

 - ">" ポインタをインクリメントする。
   - ポインタをptrとすると、C言語の「ptr++;」に相当する。
 - "<" ポインタをデクリメントする。
   - C言語の「ptr--;」に相当。
 - "+" ポインタが指す値をインクリメントする。
   - C言語の「(*ptr)++;」に相当。
 - "-" ポインタが指す値をデクリメントする。
   - C言語の「(*ptr)--;」に相当。
 - "." ポインタが指す値を出力に書き出す。
   - C言語の「putchar(*ptr);」に相当。
 - "," 入力から1バイト読み込んで、ポインタが指す先に代入する。
   - C言語の「*ptr=getchar();」に相当。
 - "[" ポインタが指す値が0なら、対応する ] の直後にジャンプする。
   - C言語の「while(*ptr){」に相当。
 - "]" ポインタが指す値が0でないなら、対応する [ （の直後[1]）にジャンプする。
   - C言語の「}」に相当。

このプログラミング言語のhello worldは、例えば次のように書けます：

```bf
+++++++++[>++++++++>+++++++++++>+++++<<<-]>.>++.+++++++..+++.>-.
------------.<++++++++.--------.+++.------.--------.>+.
```

インタプリタがWeb上にいくつかあるので、遊んで見るのもよいでしょう：
https://copy.sh/brainfuck/

　このBrainfuckは[万能チューリングマシン](https://ja.wikipedia.org/wiki/%E3%83%81%E3%83%A5%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0%E3%83%9E%E3%82%B7%E3%83%B3#.E4.B8.87.E8.83.BD.E3.83.81.E3.83.A5.E3.83.BC.E3.83.AA.E3.83.B3.E3.82.B0.E3.83.9E.E3.82.B7.E3.83.B3)に極めて近いです。…プログラムが激しく書きづらいところも含めて…。

　Brainfuckは万能チューリングマシンと実際に等価な力をもつチューリング完全な言語、つまり普通のコンピュータと計算能力的には等しい力をもつことが分かっています。

　今回は、このBrainfuckプログラムをSATの問題へと変換し、SATのソルバー上で実行しましょう！

## 論理変数の構成を設計する

　ここまでの準備があれば、もう簡単です。一番難しいのは、データ構造（＝論理変数の構成）を設計する所でしょうか？

```hs
data Component =
    PC Time Int |
    IC Time Int |
    InTape Int Int |
    MC Time Int |
    MidTape Time Int Int |
    OC Time Int |
    OutTape Int Int |
    Tmp [Int]
  deriving (Eq,Show,Read,Ord)
```

 - PCはプログラムカウンタ：次にどの命令を実行するか
 - ICはインプットカウンタ：次に,で読むのは入力の何文字目か
 - OCはアウトプットカウンタ：次に.で書き込む先は何文字目か
 - MCは計算用中間テープカウンタ：ポインタの位置
 - InTape/MidTape/OutTape：入力・計算用中間テープ・出力テープの値

　SATにはgetcharもputcharもないので、入力は事前にバイト列として（論理式に変換して）与えた上で出力も論理変数の割当てから読み取ることになります。これがInTape/OutTape論理変数の役割です。

　InTapeとOutTape以外の論理変数には`Time`という型の値が付属しています。これは読んだ通り「時間」で、実体は`Int`です。

　どういう事かというと、まずSATには時間発展の機能がない事を確認しましょう。Brainfuckのプログラムは時々刻々とメモリの内容やポインタの位置が更新されていきますが、SATの論理変数は一度真偽が割当てられれば、それでおしまいです。ということは、ただひとつ`PC Int`といった論理変数を一式作っただけではBrainfuckのプログラムの刻々と実行されていく現象を表現できないということになります。

　そこで、Brainfuckプログラムが実行されていくごとにメモリやポインタといったその実行途中の結果（計算機科学の教科書っぽくいえば、**時点表示**）を次の時間を表す論理変数に次々に代入していくように論理式を設計します。

　しかし、

## 

## SATはチューリング完全ではない

　このBrainfuckの構成は、ほぼホップクロフトの本で万能チューリングマシンをSATの問題に変換しているのと同じ方法を使っています。でも注意して欲しいのは、ホップクロフトの本でもSATがチューリング完全であることを証明しているわけでは**ない**ことです。


